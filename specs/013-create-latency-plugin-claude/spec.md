# Feature Specification: Create latency-plugin-claude-code + interface

**Branch**: `013-create-latency-plugin-claude` | **Date**: 2026-02-03 | **Status**: Draft

## Summary

## Parent Epic
Part of #1 (Phase 1 - Repository & Package Setup) - Phase 1C

## Description

Create the Claude Code implementation with two packages:
1. **latency-plugin-claude-code** - The implementation
2. **claude-code-interface** - Types for consumers

## Plugin Package

```typescript
// @generacy-ai/latency-plugin-claude-code

import { AbstractDevAgentPlugin, InternalInvokeOptions } from '@generacy-ai/latency-plugin-dev-agent';
import { ClaudeCodeResult, ClaudeCodeCapabilities } from '@generacy-ai/claude-code-interface';
import { execa } from 'execa';

export class ClaudeCodePlugin extends AbstractDevAgentPlugin {
  private cliPath: string;
  private workingDirectory: string;

  constructor(config: ClaudeCodeConfig) {
    super();
    this.cliPath = config.cliPath ?? 'claude';
    this.workingDirectory = config.workingDirectory;
  }

  protected async doInvoke(prompt: string, options: InternalInvokeOptions): Promise<ClaudeCodeResult> {
    const args = this.buildArgs(prompt, options);
    const result = await execa(this.cliPath, args, {
      cwd: this.workingDirectory,
      signal: options.signal
    });
    return this.parseResult(result);
  }

  async getCapabilities(): Promise<ClaudeCodeCapabilities> {
    // Query claude --version and capabilities
  }

  // Claude Code-specific methods
  async invokeInDocker(prompt: string, containerConfig: DockerConfig): Promise<ClaudeCodeResult>;
  async invokeWithMCP(prompt: string, mcpServers: MCPServerConfig[]): Promise<ClaudeCodeResult>;
}

export interface ClaudeCodeConfig {
  cliPath?: string;
  workingDirectory: string;
  model?: string;
  maxTokens?: number;
}
```

## Interface Package

```typescript
// @generacy-ai/claude-code-interface

import { AgentResult, AgentCapabilities } from '@generacy-ai/latency';

export interface ClaudeCodeResult extends AgentResult {
  /** Model used for the invocation */
  model: string;
  
  /** Token usage */
  usage: {
    inputTokens: number;
    outputTokens: number;
  };
  
  /** Files modified during invocation */
  modifiedFiles: string[];
  
  /** Tools called during invocation */
  toolCalls: ClaudeCodeToolCall[];
  
  /** Session ID for continuation */
  sessionId?: string;
}

export interface ClaudeCodeToolCall {
  name: string;
  input: unknown;
  output: unknown;
  duration: number;
}

export interface ClaudeCodeCapabilities extends AgentCapabilities {
  version: string;
  availableModels: string[];
  supportsMCP: boolean;
  supportsDocker: boolean;
}

export function isClaudeCodeResult(result: AgentResult): result is ClaudeCodeResult;
```

## Tasks

- [ ] Create both package directory structures
- [ ] Implement ClaudeCodePlugin extending abstract
- [ ] Implement CLI invocation with execa
- [ ] Implement Docker container invocation
- [ ] Define Claude Code-specific types in interface package
- [ ] Implement type guards and helpers
- [ ] Write tests with mocked CLI

## Dependencies

### Plugin
- `@generacy-ai/latency-plugin-dev-agent`
- `@generacy-ai/claude-code-interface`
- `execa`

### Interface
- `@generacy-ai/latency` (types only)

## User Stories

### US1: [Primary User Story]

**As a** [user type],
**I want** [capability],
**So that** [benefit].

**Acceptance Criteria**:
- [ ] [Criterion 1]
- [ ] [Criterion 2]

## Functional Requirements

| ID | Requirement | Priority | Notes |
|----|-------------|----------|-------|
| FR-001 | [Description] | P1 | |

## Success Criteria

| ID | Metric | Target | Measurement |
|----|--------|--------|-------------|
| SC-001 | [Metric] | [Target] | [How to measure] |

## Assumptions

- [Assumption 1]

## Out of Scope

- [Exclusion 1]

---

*Generated by speckit*
