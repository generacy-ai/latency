# Research: latency-plugin-jira + jira-interface

## Technology Decisions

### 1. Injectable HTTP Adapter (vs. specific client library)

**Decision**: Define a `JiraHttpAdapter` interface rather than depending on `jira.js` or `axios`.

**Rationale**:
- The latency ecosystem uses a composition/plugin architecture — injectable dependencies fit naturally
- Avoids locking consumers into a specific HTTP library
- Consumers may already have a configured HTTP client with auth, retry, and proxy logic
- Keeps the plugin package lean (no transitive HTTP dependencies)
- Consumers can use `jira.js`, `axios`, `node-fetch`, or any other HTTP library under the adapter

**Alternatives considered**:
- `jira.js`: Well-maintained, typed, but large dependency tree and opinionated auth
- Direct `fetch()`: Simple but would need auth, retry, error handling built in
- `axios`: Popular but another dependency to manage

### 2. Jira REST API v2 (vs. v3)

**Decision**: Target Jira REST API v2.

**Rationale**:
- v2 uses wiki markup for text, which is simpler to handle
- v2 works with both Jira Cloud and Jira Server/Data Center
- v3 uses Atlassian Document Format (ADF), which requires a complex document model
- The `Issue.body` field in the core types is plain `string` — v2's wiki markup maps naturally
- v3 can be added later via a configuration option without breaking v2 consumers

### 3. Open String Types (vs. string enums)

**Decision**: Use plain `string` type aliases for `JiraIssueType`, `JiraPriority`, etc.

**Rationale**:
- Jira allows fully custom issue types, priorities, and statuses
- String enums would require maintenance as Jira evolves
- Custom Jira setups (common in enterprise) would constantly hit escape hatches
- TypeScript structural typing still provides safety at the interface boundary
- Consumers can narrow types in their own code if needed

### 4. Flat Package Layout (vs. grouped interfaces/)

**Decision**: Place `jira-interface` at `packages/jira-interface/` (flat).

**Rationale**:
- Consistent with existing package naming (`packages/latency-plugin-*`)
- The `pnpm-workspace.yaml` already uses `packages/*` glob
- A `packages/interfaces/` subdirectory would require workspace config changes
- First interface package — no need to prematurely create a grouping structure

## Implementation Patterns

### Template Method Pattern (inherited from abstract)
The `AbstractIssueTrackerPlugin` uses Template Method:
- Public methods handle caching, validation
- Protected `do*` methods are implemented by subclasses
- `JiraPlugin` only implements `fetchIssue`, `doCreateIssue`, `doUpdateIssue`, `doListIssues`, `doAddComment`

### Response Mapping
Jira REST API returns deeply nested JSON. A dedicated `mapper.ts` module:
- Isolates API response shape from domain types
- Makes response structure changes easy to accommodate
- Simplifies testing (mapper tests use raw JSON fixtures)

### JQL Query Building
`listIssues(query: IssueQuery)` translates to JQL:
- `state: 'open'` → `status != Done`
- `state: 'closed'` → `status = Done`
- `labels: ['bug']` → `labels in (bug)`
- `assignee: 'john'` → `assignee = john`
- Combined with `AND` operators
- Pagination via `startAt` + `maxResults` parameters

## Key API Endpoints (Jira REST API v2)

| Operation | Method | Endpoint |
|-----------|--------|----------|
| Get issue | GET | `/rest/api/2/issue/{issueIdOrKey}` |
| Create issue | POST | `/rest/api/2/issue` |
| Update issue | PUT | `/rest/api/2/issue/{issueIdOrKey}` |
| Search (JQL) | GET | `/rest/api/2/search?jql=...` |
| Add comment | POST | `/rest/api/2/issue/{issueIdOrKey}/comment` |
| Get transitions | GET | `/rest/api/2/issue/{issueIdOrKey}/transitions` |
| Do transition | POST | `/rest/api/2/issue/{issueIdOrKey}/transitions` |
| Link issues | POST | `/rest/api/2/issueLink` |

## References

- [Jira REST API v2 Documentation](https://developer.atlassian.com/cloud/jira/platform/rest/v2/)
- [Jira JQL Reference](https://support.atlassian.com/jira-software-cloud/docs/use-advanced-search-with-jql/)
- Existing abstract plugin: `packages/latency-plugin-issue-tracker/src/abstract-plugin.ts`

---

*Generated by speckit*
