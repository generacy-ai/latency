# Data Model: GitHub Actions Plugin

## Core Entity Relationships

```
Pipeline (core)
  └── GitHubWorkflow (extends)
        ├── path: string
        ├── state: WorkflowState
        └── triggers: GitHubWorkflowTrigger[]

PipelineRun (core)
  └── GitHubWorkflowRun (extends)
        ├── workflowId: number
        ├── runNumber: number
        ├── attempt: number
        ├── triggeredBy: string
        ├── headSha: string
        ├── headBranch: string
        └── jobs: GitHubJob[]
                   ├── id: number
                   ├── name: string
                   ├── status: JobStatus
                   ├── conclusion?: JobConclusion
                   └── steps: GitHubStep[]
                              ├── number: number
                              ├── name: string
                              ├── status: StepStatus
                              └── conclusion?: StepConclusion
```

## Type Definitions

### Extended Core Types

```typescript
// Extends Pipeline from @generacy-ai/latency
interface GitHubWorkflow extends Pipeline {
  path: string;
  state: 'active' | 'disabled_inactivity' | 'disabled_manually';
  triggers: GitHubWorkflowTrigger[];
}

// Extends PipelineRun from @generacy-ai/latency
interface GitHubWorkflowRun extends PipelineRun {
  workflowId: number;
  runNumber: number;
  attempt: number;
  triggeredBy: string;
  headSha: string;
  headBranch: string;
  jobs: GitHubJob[];
}
```

### GitHub-Specific Types

```typescript
interface GitHubWorkflowTrigger {
  event: string;           // 'push', 'pull_request', 'workflow_dispatch', 'schedule', etc.
  branches?: string[];     // Branch filters (if applicable)
  paths?: string[];        // Path filters (if applicable)
  cron?: string;           // Cron expression (for 'schedule' event)
}

interface GitHubJob {
  id: number;
  name: string;
  status: 'queued' | 'in_progress' | 'completed';
  conclusion?: 'success' | 'failure' | 'cancelled' | 'skipped';
  startedAt?: Date;
  completedAt?: Date;
  steps: GitHubStep[];
}

interface GitHubStep {
  number: number;
  name: string;
  status: 'queued' | 'in_progress' | 'completed';
  conclusion?: 'success' | 'failure' | 'cancelled' | 'skipped';
  startedAt?: Date;
  completedAt?: Date;
}

interface GitHubArtifact {
  id: number;
  name: string;
  sizeInBytes: number;
  archiveDownloadUrl: string;
  expired: boolean;
  createdAt: Date;
  expiresAt?: Date;
}
```

### Configuration Type

```typescript
interface GitHubActionsConfig {
  token: string;            // GitHub PAT or app installation token
  owner: string;            // Repository owner (user or org)
  repo: string;             // Repository name
  apiBaseUrl?: string;      // Optional: GitHub Enterprise base URL
}
```

## Status Mapping

### GitHub → Core Status

| GitHub `status` | GitHub `conclusion` | Core `PipelineStatus` |
|-----------------|---------------------|-----------------------|
| `queued` | — | `'pending'` |
| `in_progress` | — | `'running'` |
| `completed` | `success` | `'completed'` |
| `completed` | `failure` | `'failed'` |
| `completed` | `timed_out` | `'failed'` |
| `completed` | `cancelled` | `'cancelled'` |
| `completed` | `skipped` | `'completed'` |
| `completed` | `action_required` | `'running'` |

### Synthetic Run (post-dispatch)

When `doTrigger` is called, `createWorkflowDispatch` returns void. The plugin creates:

```typescript
{
  id: `dispatch-${Date.now()}`,       // Synthetic ID
  pipelineId: workflowId,
  status: 'pending',
  createdAt: new Date(),
  // startedAt, completedAt, logsUrl: undefined
}
```

## Validation Rules

| Field | Rule | Error Code |
|-------|------|------------|
| `config.token` | Non-empty string | `VALIDATION_ERROR` |
| `config.owner` | Non-empty string | `VALIDATION_ERROR` |
| `config.repo` | Non-empty string | `VALIDATION_ERROR` |
| `pipelineId` (in trigger) | Non-empty string | `VALIDATION_ERROR` (handled by base class) |
| `runId` (in getStatus/cancel) | Non-empty string | `VALIDATION_ERROR` (handled by base class) |

---

*Generated by speckit*
