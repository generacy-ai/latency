# Feature Specification: Document planned facets and reconcile dual StateStore

**Branch**: `029-document-planned-facets-reconcile` | **Date**: 2026-02-08 | **Status**: Draft

## Summary

Two cleanup items in the latency core package to improve code clarity and documentation.

### 1. Unused Facet Interfaces

Five facet interfaces are defined and exported but currently have no consumers:
- `EventBus` (facets/events.ts)
- `SecretStore` (facets/secrets.ts)
- `StateStore` (facets/state.ts)
- `DecisionHandler` (facets/decision.ts)
- `WorkflowEngine` (facets/workflow.ts)

**Decision**: Keep all 5 facets as planned. Per architecture documentation, all five are explicitly referenced in the active roadmap:
- **DecisionHandler** — Integration plan Phase 3.3 and execution plan Wave 6 specify Humancy will register as a DecisionHandler facet provider
- **WorkflowEngine** — Phase 3.2 and Wave 6 specify Generacy provides WorkflowEngine
- **EventBus, StateStore, SecretStore** — Listed as core cross-cutting concern facets in the architecture doc's facet categories table

### 2. Dual StateStore Definitions

Two `StateStore` interfaces exist with different signatures:
- **facets/state.ts**: Async, generic type parameters — `get<T>(key): Promise<T | undefined>` — for persistent storage backends (Redis, S3, etc.)
- **composition/context.ts**: Synchronous — `get(key): unknown` — for plugin-scoped in-memory state

**Decision**: Rename the sync version to `PluginStateStore` or `ContextState` to preserve both while eliminating the naming collision. The async facet version is the architecturally important one.

## Tasks

1. ~~Decide which unused facets are still planned and which should be removed~~ (Decision: Keep all 5)
2. Add documentation (JSDoc `@remarks` tags + README) clarifying facet maturity/adoption status
3. Rename the sync StateStore in composition/context.ts to `PluginStateStore` or `ContextState`
4. Check and remove `LogLevel` type from facets/logging.ts if unused

## User Stories

### US1: Developer Clarity on Facet Status

**As a** developer working with the latency codebase,
**I want** clear documentation on which facets are actively used vs awaiting consumer adoption,
**So that** I understand the maturity level of each interface and don't accidentally remove planned features.

**Acceptance Criteria**:
- [ ] Each facet file has JSDoc `@remarks` indicating adoption status
- [ ] A README in facets/ provides centralized overview of facet maturity levels
- [ ] Active facets (IssueTracker, SourceControl, DevAgent, etc.) are distinguished from Phase 3 pending facets

### US2: Unambiguous StateStore Naming

**As a** developer using state management,
**I want** distinct names for the async facet StateStore and sync plugin StateStore,
**So that** I import the correct interface without confusion.

**Acceptance Criteria**:
- [ ] The sync StateStore in composition/context.ts is renamed to PluginStateStore or ContextState
- [ ] All internal usages are updated to the new name
- [ ] No naming collision exists between the two state interfaces

## Functional Requirements

| ID | Requirement | Priority | Notes |
|----|-------------|----------|-------|
| FR-001 | Add JSDoc @remarks to all 5 planned facet interfaces indicating Phase 3 adoption status | P1 | Use wording like "Awaiting consumer adoption in Phase 3" |
| FR-002 | Create facets/README.md documenting facet categories and adoption status | P1 | Include table of active vs pending facets |
| FR-003 | Rename StateStore in composition/context.ts to PluginStateStore | P1 | Update all internal references |
| FR-004 | Verify LogLevel type usage and remove if unused | P2 | |

## Success Criteria

| ID | Metric | Target | Measurement |
|----|--------|--------|-------------|
| SC-001 | Documentation coverage | 100% of facets documented | All facet files have @remarks tags |
| SC-002 | No naming conflicts | 0 duplicate StateStore definitions | grep for "interface StateStore" returns only facets/state.ts |
| SC-003 | Build passes | No TypeScript errors | pnpm build succeeds |

## Assumptions

- The architecture docs (latency-architecture.md, latency-integration-plan.md, latency-execution-plan.md) are authoritative for roadmap decisions
- Phase 3 consumer adoption is still planned (roadmap hasn't changed)

## Out of Scope

- Implementing actual consumers for the planned facets
- Adding new facet interfaces beyond what exists
- Changing the async StateStore interface signature

---

*Generated by speckit*
