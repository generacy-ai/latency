# Implementation Plan: Document planned facets and reconcile dual StateStore

**Feature**: Document planned facets and reconcile dual StateStore
**Branch**: `029-document-planned-facets-reconcile`
**Status**: Complete

## Summary

This feature addresses two documentation and naming issues in the latency core package:

1. **Document Planned Facets**: Add JSDoc `@remarks` tags and a README to clarify the adoption status of five facet interfaces (EventBus, SecretStore, StateStore, DecisionHandler, WorkflowEngine) that are defined but awaiting Phase 3 consumer adoption.

2. **Reconcile Dual StateStore**: Rename the synchronous `StateStore` interface in `composition/context.ts` to `PluginStateStore` to eliminate naming collision with the async facet `StateStore` in `facets/state.ts`.

3. **Verify LogLevel Usage**: Confirm whether `LogLevel` type in `facets/logging.ts` is exported/used; remove if unused.

## Technical Context

- **Language**: TypeScript
- **Package**: `packages/latency` (core library)
- **Build System**: pnpm + TypeScript compiler
- **No Runtime Dependencies**: Pure type changes and documentation

## Project Structure

```
packages/latency/
├── src/
│   ├── facets/
│   │   ├── index.ts           # Re-exports all facets
│   │   ├── README.md          # NEW: Facet maturity documentation
│   │   ├── events.ts          # EventBus interface (add @remarks)
│   │   ├── secrets.ts         # SecretStore interface (add @remarks)
│   │   ├── state.ts           # StateStore interface (add @remarks)
│   │   ├── decision.ts        # DecisionHandler interface (add @remarks)
│   │   ├── workflow.ts        # WorkflowEngine interface (add @remarks)
│   │   └── logging.ts         # Logger + LogLevel (verify usage)
│   ├── composition/
│   │   ├── context.ts         # StateStore → PluginStateStore rename
│   │   └── index.ts           # Update export
│   └── index.ts               # Update re-export
```

## Implementation Approach

### Phase 1: Document Planned Facets

Add JSDoc `@remarks` tags to each of the 5 planned facet interfaces indicating they are awaiting Phase 3 consumer adoption:

```typescript
/**
 * @remarks
 * **Adoption Status**: This interface is defined and stable, but currently awaiting
 * consumer adoption in Phase 3. See `facets/README.md` for the full facet maturity matrix.
 */
```

Create `facets/README.md` with:
- Overview of the facet architecture
- Table categorizing facets by maturity level (Active vs Awaiting Adoption)
- Brief explanation of Phase 3 adoption timeline

### Phase 2: Rename Sync StateStore

1. Rename `StateStore` → `PluginStateStore` in `composition/context.ts`
2. Update the `PluginContext.state` type reference
3. Update `composition/index.ts` export
4. Update `src/index.ts` re-export

### Phase 3: Verify LogLevel Usage

`LogLevel` is defined in `facets/logging.ts` and exported via `facets/index.ts` → `src/index.ts`. The type is part of the public API and documented in the module's JSDoc. **Conclusion: Keep LogLevel** — it's a useful public type for consumers implementing or configuring loggers.

## Key Technical Decisions

| Decision | Rationale |
|----------|-----------|
| Keep all 5 facets | All are explicitly referenced in Phase 3 architecture docs |
| Use JSDoc `@remarks` | Inline discoverability in IDEs; no separate file needed per interface |
| Add facets/README.md | Centralized maturity overview; complements inline docs |
| Rename to `PluginStateStore` | Clear distinction; "Plugin" prefix matches `PluginContext` naming |
| Keep `LogLevel` type | Part of public API, useful for consumer implementations |

## Files to Modify

| File | Change |
|------|--------|
| `src/facets/events.ts` | Add `@remarks` to `EventBus` |
| `src/facets/secrets.ts` | Add `@remarks` to `SecretStore` |
| `src/facets/state.ts` | Add `@remarks` to `StateStore` |
| `src/facets/decision.ts` | Add `@remarks` to `DecisionHandler` |
| `src/facets/workflow.ts` | Add `@remarks` to `WorkflowEngine` |
| `src/facets/README.md` | Create: Facet maturity matrix |
| `src/composition/context.ts` | Rename `StateStore` → `PluginStateStore` |
| `src/composition/index.ts` | Update export to `PluginStateStore` |
| `src/index.ts` | Update re-export to `PluginStateStore` |

## Success Criteria

- [ ] All 5 planned facet interfaces have `@remarks` tags
- [ ] `facets/README.md` exists with maturity matrix
- [ ] No `interface StateStore` in `composition/context.ts`
- [ ] `PluginStateStore` is properly exported
- [ ] `pnpm build` succeeds with no errors
- [ ] No duplicate `StateStore` definitions (grep returns only `facets/state.ts`)

## Next Step

Run `/speckit:tasks` to generate the detailed task list.

---

*Generated by speckit*
