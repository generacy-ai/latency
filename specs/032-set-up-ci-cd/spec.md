# Feature Specification: ## Set up CI/CD and npm publishing

Configure automated CI and npm publishing for the latency repo's @generacy-ai scoped packages

**Branch**: `032-set-up-ci-cd` | **Date**: 2026-02-25 | **Status**: Draft

## Summary

## Set up CI/CD and npm publishing

Configure automated CI and npm publishing for the latency repo's @generacy-ai scoped packages.

### Tasks

1. **CI workflow** (`.github/workflows/ci.yml`)
   - Lint, test, build on PRs and pushes to `develop`/`main`
   - Use pnpm with `--frozen-lockfile`

2. **Changesets setup**
   - Install `@changesets/cli`
   - Add `.changeset/config.json` with `baseBranch: "develop"`, `access: "public"`
   - Developers add changeset files in PRs to describe changes

3. **Preview publish workflow** (`.github/workflows/publish-preview.yml`)
   - On push to `develop`, publish snapshot versions with `@preview` dist-tag
   - Only publish when `.changeset/*.md` files are present (no noise from docs-only changes)
   - Format: `1.0.0-preview.20260225143022` (datetime-based via changesets snapshot)

4. **Stable release workflow** (`.github/workflows/release.yml`)
   - On push to `main`, use `changesets/action` to create "Version Packages" PR
   - Merging that PR triggers stable publish with `@latest` dist-tag

5. **Package configuration**
   - Add `publishConfig: { "access": "public" }` to all publishable packages
   - Ensure all packages use `@generacy-ai/` scope

6. **Branch protection on `main`**
   - Require PR, require CI status checks (build + tests + lint)
   - Initial sync: reset `main` to match `develop` (main only has initial commits)

### Publishing details
- All packages published with `--access public`
- `NPM_TOKEN` GitHub secret required (org-level)
- Latency publishes first in the dependency chain (latency → agency → generacy)
- Workflows should be idempotent — re-running skips already-published packages

### Acceptance criteria
- CI runs on all PRs
- Preview versions publish on merge to `develop` when changesets are present
- Stable versions publish via changesets workflow on `main`

### Context
Replaces cross-repo issue generacy-ai/generacy#242 which has been closed.

## User Stories

### US1: [Primary User Story]

**As a** [user type],
**I want** [capability],
**So that** [benefit].

**Acceptance Criteria**:
- [ ] [Criterion 1]
- [ ] [Criterion 2]

## Functional Requirements

| ID | Requirement | Priority | Notes |
|----|-------------|----------|-------|
| FR-001 | [Description] | P1 | |

## Success Criteria

| ID | Metric | Target | Measurement |
|----|--------|--------|-------------|
| SC-001 | [Metric] | [Target] | [How to measure] |

## Assumptions

- [Assumption 1]

## Out of Scope

- [Exclusion 1]

---

*Generated by speckit*
