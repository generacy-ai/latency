# Speckit Feature Development Workflow
#
# Standard feature development workflow using the speckit methodology:
# specify → clarify → plan → tasks → implement
#
# Usage:
#   generacy run workflows/speckit-feature.yaml --input description="Your feature description"
#
# Inputs:
#   - description: Feature description text (required)
#   - issue_url: GitHub issue URL for additional context (optional)
#   - short_name: Branch short name override (optional)
#
name: speckit-feature

description: |
  Standard feature development workflow following spec-driven development.
  Creates a feature branch, generates specification, clarifies requirements,
  plans implementation, generates tasks, and executes implementation.

version: "1.0.0"

inputs:
  - name: description
    description: Feature description used to generate spec content
    type: string
    required: true

  - name: issue_url
    description: GitHub issue URL for additional context
    type: string
    required: false

  - name: issue_number
    description: GitHub issue number to use as feature number
    type: number
    required: false

  - name: short_name
    description: Optional short name for the feature branch
    type: string
    required: false

phases:
  # Phase 1: Setup
  - name: setup
    steps:
      - name: create-feature
        uses: speckit.create_feature
        with:
          description: ${{ inputs.description }}
          short_name: ${{ inputs.short_name }}
          number: ${{ inputs.issue_number }}

  # Phase 2: Specification
  - name: specification
    steps:
      - name: specify
        uses: speckit.specify
        with:
          feature_dir: ${{ steps.create-feature.output.feature_dir }}
          issue_url: ${{ inputs.issue_url }}
        gate: spec-review

  # Phase 3: Clarification
  - name: clarification
    steps:
      - name: clarify
        uses: speckit.clarify
        with:
          feature_dir: ${{ steps.create-feature.output.feature_dir }}
        gate: clarification-review

  # Phase 4: Planning
  - name: planning
    steps:
      - name: plan
        uses: speckit.plan
        with:
          feature_dir: ${{ steps.create-feature.output.feature_dir }}
        gate: plan-review

  # Phase 5: Task Generation
  - name: task-generation
    steps:
      - name: tasks
        uses: speckit.tasks
        with:
          feature_dir: ${{ steps.create-feature.output.feature_dir }}
        gate: tasks-review

  # Phase 6: Implementation
  - name: implementation
    steps:
      - name: implement
        uses: speckit.implement
        with:
          feature_dir: ${{ steps.create-feature.output.feature_dir }}
        timeout: 3600000  # 1 hour max

  # Phase 7: Verification
  - name: verification
    steps:
      - name: run-tests
        uses: verification.check
        with:
          command: npm test
        continueOnError: true

      - name: run-lint
        uses: verification.check
        with:
          command: npm run lint
        continueOnError: true

  # Phase 8: PR Creation
  - name: pr-creation
    condition: ${{ success() }}
    steps:
      - name: create-pr
        uses: pr.create
        with:
          title: "feat: ${{ inputs.description }}"
          body: |
            ## Summary
            ${{ steps.specify.output.summary }}

            ## Implementation
            - Tasks completed: ${{ steps.implement.output.tasks_completed }}
            - Files modified: ${{ steps.implement.output.files_modified }}

            ---
            Generated by speckit-feature workflow
          draft: true
